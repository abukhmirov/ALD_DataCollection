let currentBranch = 'MA'; // Default branch on page load

window.onload = function() {
    // Initialize counters and display when the page loads
    changeBranch(); // Load counts and update total for the default branch
};

function changeBranch() {
    currentBranch = document.getElementById('branchSelector').value;
    loadCounts();
    updateTotal();
}

function saveCounts() {
    // Save each counter's value in local storage with a key specific to the branch
    localStorage.setItem(currentBranch + '_printing', document.getElementById('printing').textContent);
    localStorage.setItem(currentBranch + '_patron', document.getElementById('patron').textContent);
    localStorage.setItem(currentBranch + '_library', document.getElementById('library').textContent);
}

function loadCounts() {
    // Load counts from local storage or default to '0' if not previously set
    document.getElementById('printing').textContent = localStorage.getItem(currentBranch + '_printing') || '0';
    document.getElementById('patron').textContent = localStorage.getItem(currentBranch + '_patron') || '0';
    document.getElementById('library').textContent = localStorage.getItem(currentBranch + '_library') || '0';
}

function updateTotal() {
    // Update the total counter by summing all categories
    const printingCount = parseInt(document.getElementById('printing').textContent);
    const patronCount = parseInt(document.getElementById('patron').textContent);
    const libraryCount = parseInt(document.getElementById('library').textContent);
    document.getElementById('total').textContent = printingCount + patronCount + libraryCount;
}

function increment(category) {
    // Increment the value of a counter when the '+' button is clicked
    const element = document.getElementById(category);
    let currentCount = parseInt(element.textContent);
    element.textContent = currentCount + 1;
    updateTotal();
    saveCounts();
}

function decrement(category) {
    // Decrement the value of a counter when the '-' button is clicked, if greater than 0
    const element = document.getElementById(category);
    let currentCount = parseInt(element.textContent);
    if (currentCount > 0) {
        element.textContent = currentCount - 1;
        updateTotal();
        saveCounts();
    }
}

function resetBranchCounters() {
    // Reset all counters for the current branch to '0' and update local storage
    document.getElementById('printing').textContent = '0';
    document.getElementById('patron').textContent = '0';
    document.getElementById('library').textContent = '0';
    updateTotal();

    localStorage.setItem(currentBranch + '_printing', '0');
    localStorage.setItem(currentBranch + '_patron', '0');
    localStorage.setItem(currentBranch + '_library', '0');
}

function finalizeData() {
    const printingCount = document.getElementById('printing').textContent;
    const patronCount = document.getElementById('patron').textContent;
    const libraryCount = document.getElementById('library').textContent;
    const totalCount = document.getElementById('total').textContent;

    // Create a formatted string that resembles a row in Excel
    const dataString = `Branch: ${currentBranch}\tPrinting: ${printingCount}\tPatron: ${patronCount}\tLibrary: ${libraryCount}\tTotal: ${totalCount}`;

    // Display this string in a textarea to allow easy copying
    const output = document.createElement('textarea');
    output.value = dataString;
    output.rows = 1;
    output.cols = 100; // Set the width of the textarea large enough to show the entire string
    output.readOnly = true; // Prevent editing of the content

    // Optional: Automatically select the text to make copying even easier
    output.onclick = function() {
        output.select();
    };

    // Clear any previous output and append the new data
    const outputContainer = document.getElementById('outputContainer');
    outputContainer.innerHTML = ''; // Clear previous outputs
    outputContainer.appendChild(output); // Add the new output textarea

    // Append the output container to the body or any specific section of your page
    document.body.appendChild(outputContainer);
}


